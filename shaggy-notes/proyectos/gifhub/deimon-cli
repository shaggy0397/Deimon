#!/data/data/com.termux/files/usr/bin/bash

APP_NAME="GifHub"
PROJECT_DIR="$HOME/shaggy-notes/proyectos/gifhub"
APK_OUT="$PROJECT_DIR/build/outputs/apk/release/app-release.apk"
KEYSTORE="$HOME/.keys/gifhub.keystore"
ALIAS="gifhubkey"

# ğŸ¨ Arte visual
echo -e "\e[38;5;51m"
figlet "$APP_NAME Build"
echo -e "\e[0m"

# ğŸ“ Validar estructura
echo "ğŸ” Validando carpetas..."
[[ -d "$PROJECT_DIR" ]] || { echo "âŒ Proyecto no encontrado."; exit 1; }
mkdir -p "$(dirname "$APK_OUT")"

# âš™ï¸ Simular compilaciÃ³n (reemplaza con tu build real si usas Gradle)
echo "ğŸ“¦ Compilando APK..."
echo "APK simulado para $APP_NAME" > "$APK_OUT"

# ğŸ” Firma (si existe keystore)
if [[ -f "$KEYSTORE" ]]; then
  echo "ğŸ” Firmando APK..."
  apksigner sign --ks "$KEYSTORE" --ks-key-alias "$ALIAS" "$APK_OUT" && echo "âœ… Firma completada."
else
  echo "âš ï¸ Keystore no encontrado. Saltando firma."
fi

# ğŸ“² Instalar APK
echo "ğŸ“² Instalando APK..."
pm install -r "$APK_OUT" && echo "âœ… InstalaciÃ³n exitosa." || echo "âŒ Error al instalar."

# ğŸ§ª ValidaciÃ³n visual
echo -e "\nğŸ“ Contenido final:"
ls -lh "$APK_OUT"
